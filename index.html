<!DOCTYPE HTML>
<html lang="em">
<head>
<meta charset="UTF-8">

<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
<style>

img{
  display: block;
  vertical-align: middle;
  margin-left: 23vw;
}

body {
  background: #d9d9d9;
}

@import url("//fonts.googleapis.com/css?family=Lato:400");

body { 
  background-color: #222;
  font-family: "Lato", "Helvetica Neue", Helvetica, Arial, sans-serif;  
}

.container {
  background: #494949;
  padding:1.5em 2em;
  margin:2em;

}

img.polaroid {
  background:#000; /*Change this to a background image or remove*/
  border:solid #fff;
  border-width:6px 6px 40px 6px;
  box-shadow:1px 1px 5px #333; /* Standard blur at 5px. Increase for more depth */
  -webkit-box-shadow:1px 1px 5px #333;
  -moz-box-shadow:1px 1px 5px #333;
  height:auto; /*Set to height of your image or desired div*/
  width:50vw; /*Set to width of your image or desired div*/
  margin-top: 1em;
}

.fade {
  transition: all 0.4s ease-out;
  opacity: 0;
}
.fade .show {
  opacity: 1;
}

</style>

</head>
<body>        


  <script src="http://cdn.pubnub.com/pubnub-3.7.1.min.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>  
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

  <div id="placehere" class ="container" class="fade-in">

  </div>



<script>

    var pubnub = PUBNUB.init({
      publish_key: 'demo',
      subscribe_key: 'demo'
    });

        Parse.initialize("S7cS6MQyMb7eMjWRWsC32owq9cDx0zyrM58MSevK", "oPxXssH0RekqywNWC4Y56a2fJNCxWpoEtOzFuvRZ");
        var Selfie = Parse.Object.extend("Selfie");
        var query = new Parse.Query(Selfie);
        query.find({
        success: function(results) {
          // Do something with the returned Parse.Object values
          for (var i = results.length-1; i > -1; i--) { 
            var object = results[i];
            console.log(object.get('fileName'));
            var filedata = "data:image/png;base64," + object.get('fileData')

            var elem = document.createElement("img");
            elem.setAttribute("src", filedata);
            elem.setAttribute("class", "polaroid");

            document.getElementById("placehere").appendChild(elem);
          }
        },
        error: function(error) {
          alert("Error: " + error.code + " " + error.message);
        }
      });

  pubnub.subscribe({
    channel: 'iotchannel',
    message: function(m){
      console.log(m);

      var Selfie = Parse.Object.extend("Selfie");
      var query = new Parse.Query(Selfie);
      query.equalTo("fileName", m);
      query.find({
        success: function(results) {
          // Do something with the returned Parse.Object values
          for (var i = 0; i < results.length; i++) { 
            var object = results[i];
            console.log("Just found " + object.get('fileName'));
            var filedata = "data:image/jpg;base64," + object.get('fileData');

            var elem = document.createElement("img");
            elem.setAttribute("src", filedata);
            elem.setAttribute("class", "polaroid");
          
            var container = document.getElementById('placehere');
            container.insertBefore(document.getElementById("placehere").appendChild(elem), container.firstChild);
          }        
        

        },
        error: function(error) {
          alert("Error: " + error.code + " " + error.message);
        }
      });
    },

    error: function (error) {
      // Handle error here
      console.log(JSON.stringify(error));
    }
  });



</script>






</body>
</html>